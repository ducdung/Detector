<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="TEMU, dynamic analysis, binary analysis, dynamic
taint analysis"/>
<meta name="description" content="C/C++/OCaml Source Code Documentation for the TEMU Project."/>
<title>TEMU: TEMU_main.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">TEMU: Dynamic Binary Analysis Platform</p>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_4f22f3fd3d3cce94a331ff7cdf0bf085.html">temu-1.0</a>
  </div>
</div>
<div class="contents">
<h1>TEMU_main.c</h1><a href="TEMU__main_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">TEMU is Copyright (C) 2006-2009, BitBlaze Team.</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">TEMU is based on QEMU, a whole-system emulator. You can redistribute</span>
<a name="l00005"></a>00005 <span class="comment">and modify it under the terms of the GNU LGPL, version 2.1 or later,</span>
<a name="l00006"></a>00006 <span class="comment">but it is made available WITHOUT ANY WARRANTY. See the top-level</span>
<a name="l00007"></a>00007 <span class="comment">README file for more details.</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">For more information about TEMU and other BitBlaze software, see our</span>
<a name="l00010"></a>00010 <span class="comment">web site at: http://bitblaze.cs.berkeley.edu/</span>
<a name="l00011"></a>00011 <span class="comment">*/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include "config.h"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;dlfcn.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include "hw/hw.h"</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include "hw/pc.h"</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include "hw/isa.h"</span> <span class="comment">/* for register_ioport_write */</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "block.h"</span> <span class="comment">/* for bdrv_pread */</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include "qemu-timer.h"</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include "sysemu.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "<a class="code" href="TEMU__main_8h.html">TEMU_main.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "../shared/hookapi.h"</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a><a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d">00026</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> = 0;
<a name="l00027"></a><a class="code" href="TEMU__main_8h.html#a93b5270782d60adbbe1e95b3f87befd">00027</a> <a class="code" href="structplugin__interface__t.html" title="primary structure for TEMU plugin, including callbacks and states">plugin_interface_t</a> *<a class="code" href="TEMU__main_8c.html#a93b5270782d60adbbe1e95b3f87befd">temu_plugin</a> = NULL;
<a name="l00028"></a><a class="code" href="TEMU__main_8h.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7">00028</a> <span class="keywordtype">int</span> <a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a> = 1;
<a name="l00029"></a>00029 
<a name="l00030"></a><a class="code" href="group__main.html#gde1e39517fb49cbd640974e60b2d97b4">00030</a> target_ulong *<a class="code" href="group__main.html#gde1e39517fb49cbd640974e60b2d97b4" title="array of CPU general-purpose registers, such as R_EAX, R_EBX">TEMU_cpu_regs</a> = NULL;
<a name="l00031"></a><a class="code" href="group__main.html#g618a614f57fe705bad85a2f402251599">00031</a> target_ulong *<a class="code" href="group__main.html#g618a614f57fe705bad85a2f402251599" title="pointer to instruction pointer EIP">TEMU_cpu_eip</a> = NULL;
<a name="l00032"></a><a class="code" href="group__main.html#g4da30d59a88b0847b8c8a6e027e56f48">00032</a> target_ulong *<a class="code" href="group__main.html#g4da30d59a88b0847b8c8a6e027e56f48" title="pointer to EFLAGS">TEMU_cpu_eflags</a> = NULL;
<a name="l00033"></a><a class="code" href="group__main.html#g5bf0e7c60af3d1994fc5757696929787">00033</a> uint32_t *<a class="code" href="group__main.html#g5bf0e7c60af3d1994fc5757696929787" title="pointer to hidden flags">TEMU_cpu_hflags</a> = NULL;
<a name="l00034"></a><a class="code" href="group__main.html#g45fa83786866109995ba250447bb2256">00034</a> <a class="code" href="structSegmentCache.html">SegmentCache</a> *<a class="code" href="group__main.html#g45fa83786866109995ba250447bb2256" title="array of CPU segment registers, such as R_FS, R_CS">TEMU_cpu_segs</a> = NULL;
<a name="l00035"></a><a class="code" href="group__main.html#ga103781e7a46e2b7f7b8c5ad8a9fcc11">00035</a> <a class="code" href="structSegmentCache.html">SegmentCache</a> *<a class="code" href="group__main.html#ga103781e7a46e2b7f7b8c5ad8a9fcc11" title="pointer to LDT">TEMU_cpu_ldt</a> = NULL;
<a name="l00036"></a><a class="code" href="group__main.html#gb08fa106ad605ddf6a5558adbf00d1d8">00036</a> <a class="code" href="structSegmentCache.html">SegmentCache</a> *<a class="code" href="group__main.html#gb08fa106ad605ddf6a5558adbf00d1d8" title="pointer to GDT">TEMU_cpu_gdt</a> = NULL;
<a name="l00037"></a><a class="code" href="group__main.html#gb62c5b06089d7056967f02176c555f98">00037</a> <a class="code" href="structSegmentCache.html">SegmentCache</a> *<a class="code" href="group__main.html#gb62c5b06089d7056967f02176c555f98" title="pointer to IDT">TEMU_cpu_idt</a> = NULL;
<a name="l00038"></a><a class="code" href="group__main.html#gcb89fd3b872d66b0d5be6b25e36a68a5">00038</a> target_ulong *<a class="code" href="group__main.html#gcb89fd3b872d66b0d5be6b25e36a68a5" title="array of CPU control registers, such as CR0 and CR1">TEMU_cpu_cr</a> = NULL;
<a name="l00039"></a><a class="code" href="group__main.html#g57a9331466c08424b1d745046e82b36d">00039</a> int32_t *<a class="code" href="group__main.html#g57a9331466c08424b1d745046e82b36d" title="pointer to DF register">TEMU_cpu_df</a> = NULL; 
<a name="l00040"></a><a class="code" href="group__main.html#g7c988f9c1d0f64edcb170e87f2408ece">00040</a> uint32_t *<a class="code" href="group__main.html#g7c988f9c1d0f64edcb170e87f2408ece">TEMU_cc_op</a> = NULL;
<a name="l00041"></a><a class="code" href="group__main.html#g38b69ccb1a506dae2ad98fbeaf66ae69">00041</a> <a class="code" href="unionXMMReg.html">XMMReg</a> *<a class="code" href="group__main.html#g38b69ccb1a506dae2ad98fbeaf66ae69" title="array of XMM registers">TEMU_cpu_xmm_regs</a> = NULL;
<a name="l00042"></a><a class="code" href="group__main.html#ga264b5f9d661254b2e002588e689d5e2">00042</a> <a class="code" href="unionMMXReg.html">MMXReg</a> *<a class="code" href="group__main.html#ga264b5f9d661254b2e002588e689d5e2" title="array of MMX registers">TEMU_cpu_mmx_regs</a> = NULL;
<a name="l00043"></a><a class="code" href="group__main.html#ge9c97c111ff29e0e2c6ee2a26a094fa4">00043</a> <a class="code" href="unionFPReg.html">FPReg</a> *<a class="code" href="group__main.html#ge9c97c111ff29e0e2c6ee2a26a094fa4" title="FPU - array of Floating Point registers.">TEMU_cpu_fp_regs</a> = NULL;
<a name="l00044"></a><a class="code" href="group__main.html#g43d7eef44703fc8c40c446de5b35fd12">00044</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * <a class="code" href="group__main.html#g43d7eef44703fc8c40c446de5b35fd12" title="FPU - top of Floating Point register stack.">TEMU_cpu_fp_stt</a> = NULL;
<a name="l00045"></a><a class="code" href="group__main.html#g1c3ca604b187e41b7508bd542ef28eff">00045</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * <a class="code" href="group__main.html#g1c3ca604b187e41b7508bd542ef28eff" title="FPU - Status Register.">TEMU_cpu_fpus</a> = NULL;
<a name="l00046"></a><a class="code" href="group__main.html#g01c866766eb145d30b60cb2b8663ee3a">00046</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> * <a class="code" href="group__main.html#g01c866766eb145d30b60cb2b8663ee3a" title="FPU - Control Register.">TEMU_cpu_fpuc</a> = NULL;
<a name="l00047"></a><a class="code" href="group__main.html#g3ee3c546ab6c0db47056cdd8eb55f321">00047</a> uint8_t * <a class="code" href="group__main.html#g3ee3c546ab6c0db47056cdd8eb55f321" title="FPU - Tag Register.">TEMU_cpu_fptags</a> = NULL;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#if TAINT_FLAGS</span>
<a name="l00050"></a><a class="code" href="TEMU__main_8c.html#a84f32d4b4b1c96ef3a37d7ea0b054b6">00050</a> <span class="preprocessor"></span>uint32_t <a class="code" href="TEMU__main_8c.html#a84f32d4b4b1c96ef3a37d7ea0b054b6">TEMU_eflags</a> = 0;
<a name="l00051"></a>00051 <span class="preprocessor">#endif</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">extern</span> CPUState *<a class="code" href="TEMU__main_8c.html#3a715a3fed794e260b78c89ca643a11e">first_cpu</a>;
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">00056</a> <span class="keyword">static</span> FILE *<a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">temulog</a> = NULL;
<a name="l00057"></a><a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">00057</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a> = NULL;
<a name="l00058"></a><a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">00058</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>[PATH_MAX]=<span class="stringliteral">""</span>;
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="TEMU__main_8h.html#307420ee686f7dce54c826baaee77654">00060</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#08c9f0059115b4caac93e2012d013e82">do_enable_emulation</a>()
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062   <span class="keywordflow">if</span>(!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>) {
<a name="l00063"></a>00063   <span class="keywordflow">if</span> (temu_plugin == NULL) {
<a name="l00064"></a>00064     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"You have to load a plugin before switching to emulated mode!\n"</span>);
<a name="l00065"></a>00065   }
<a name="l00066"></a>00066   <span class="keywordflow">else</span> {
<a name="l00067"></a>00067     <a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> = 1;
<a name="l00068"></a>00068     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"Emulation is now enabled\n"</span>);
<a name="l00069"></a>00069   }
<a name="l00070"></a>00070   }
<a name="l00071"></a>00071   <span class="keywordflow">else</span> 
<a name="l00072"></a>00072     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"Emulation has been already enabled!\n"</span>);
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="TEMU__main_8h.html#ea0c8e02f6df51d1d771688e816b266a">00075</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#6a885d8e289babe0cb19bb3b669461d5">do_disable_emulation</a>()
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077   <span class="keywordflow">if</span>(<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>) {
<a name="l00078"></a>00078   <a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> = 0;
<a name="l00079"></a>00079   <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"Emulation is now disabled\n"</span>);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="TEMU__main_8h.html#4cb507949622fc763a2a146936e1421e">00084</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#4cb507949622fc763a2a146936e1421e">do_load_plugin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *plugin_path)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <a class="code" href="structplugin__interface__t.html" title="primary structure for TEMU plugin, including callbacks and states">plugin_interface_t</a> *(*init_plugin) (void);
<a name="l00087"></a>00087   <span class="keywordtype">char</span> *error;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   <span class="keywordflow">if</span> (<a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>[0]) {
<a name="l00090"></a>00090     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"%s has already been loaded! \n"</span>, plugin_path);
<a name="l00091"></a>00091     <span class="keywordflow">return</span>;
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094   <a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a> = dlopen(plugin_path, RTLD_NOW);
<a name="l00095"></a>00095   <span class="keywordflow">if</span> (NULL == <a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>) {
<a name="l00096"></a>00096     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"%s\n"</span>, dlerror());
<a name="l00097"></a>00097     <span class="keywordflow">return</span>;
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   dlerror();
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   init_plugin = dlsym(<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>, <span class="stringliteral">"init_plugin"</span>);
<a name="l00103"></a>00103   <span class="keywordflow">if</span> ((error = dlerror()) != NULL) {
<a name="l00104"></a>00104     fprintf(stderr, <span class="stringliteral">"%s\n"</span>, error);
<a name="l00105"></a>00105     dlclose(<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>);
<a name="l00106"></a>00106     <a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a> = NULL;
<a name="l00107"></a>00107     <span class="keywordflow">return</span>;
<a name="l00108"></a>00108   }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   temu_plugin = init_plugin();
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (NULL == temu_plugin) {
<a name="l00112"></a>00112     <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"fail to initialize the plugin!\n"</span>);
<a name="l00113"></a>00113     dlclose(<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>);
<a name="l00114"></a>00114     <a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a> = NULL;
<a name="l00115"></a>00115     <span class="keywordflow">return</span>;
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">temulog</a> = fopen(<span class="stringliteral">"temu.log"</span>, <span class="stringliteral">"w"</span>);
<a name="l00119"></a>00119   assert(<a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">temulog</a> != NULL);
<a name="l00120"></a>00120 <span class="preprocessor">#if TAINT_ENABLED</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#ea2c34b72ea61e4c47182e6b3fa68694">taintcheck_create</a>();
<a name="l00122"></a>00122 <span class="preprocessor">#endif </span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00124"></a>00124   <span class="keywordflow">if</span>(temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#f2ac126ff082dc76836022840e6d2674">bdrv_open</a>) {
<a name="l00125"></a>00125     <span class="keywordtype">int</span> i;
<a name="l00126"></a>00126     <span class="keywordflow">for</span>(i = 0; i &lt;= nb_drives; ++i) {
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (drives_table[i].bdrv) 
<a name="l00128"></a>00128         temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#f2ac126ff082dc76836022840e6d2674">bdrv_open</a>(i, drives_table[i].bdrv);
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130   }
<a name="l00131"></a>00131  
<a name="l00132"></a>00132   strncpy(<a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>, plugin_path, PATH_MAX);
<a name="l00133"></a>00133   <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"%s is loaded successfully!\n"</span>, plugin_path);
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="TEMU__main_8h.html#9fe2e9bd280ba5c1fd4e2b66a2253972">00136</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#296c171a88bcf16ca992030fa9e8dbd8">do_unload_plugin</a>()
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138   <a class="code" href="TEMU__main_8c.html#6a885d8e289babe0cb19bb3b669461d5">do_disable_emulation</a>();
<a name="l00139"></a>00139 
<a name="l00140"></a>00140   <span class="keywordflow">if</span>(<a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>[0]) {
<a name="l00141"></a>00141     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#893b0321029bbf4619a76d719486ff27" title="callback for cleaning up states in plugin. TEMU plugin must release all allocated...">plugin_cleanup</a>();
<a name="l00142"></a>00142     fclose(<a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">temulog</a>);
<a name="l00143"></a>00143     <a class="code" href="TEMU__main_8c.html#7927a1ad165ca9b062c982e280183fe8">temulog</a> = NULL;
<a name="l00144"></a>00144     dlclose(<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>);
<a name="l00145"></a>00145     <a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a> = NULL;
<a name="l00146"></a>00146     temu_plugin = NULL;
<a name="l00147"></a>00147   
<a name="l00148"></a>00148 <span class="preprocessor">#if TAINT_ENABLED</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>    <a class="code" href="taintcheck_8c.html#f61fde817e4429b6e0f0462599ba106e">taintcheck_cleanup</a>();
<a name="l00150"></a>00150 <span class="preprocessor">#endif</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>    <a class="code" href="group__main.html#g2c35c4aad7c5f7a9e1832adf50950e36" title="print a message to TEMU terminal">term_printf</a>(<span class="stringliteral">"%s is unloaded!\n"</span>, <a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>);
<a name="l00152"></a>00152     <a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>[0] = 0;
<a name="l00153"></a>00153   }
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 
<a name="l00157"></a>00157 <span class="comment">/*</span>
<a name="l00158"></a>00158 <span class="comment"> * Update CPU States </span>
<a name="l00159"></a>00159 <span class="comment"> */</span>
<a name="l00160"></a><a class="code" href="TEMU__main_8h.html#3d5e8ab0fd5a325201ec2bb76d74c709">00160</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#3d5e8ab0fd5a325201ec2bb76d74c709">TEMU_update_cpustate</a>()
<a name="l00161"></a>00161 {
<a name="l00162"></a>00162   <span class="keyword">static</span> CPUState *last_env = 0;
<a name="l00163"></a>00163   CPUState *cur_env = cpu_single_env? cpu_single_env: <a class="code" href="TEMU__main_8c.html#3a715a3fed794e260b78c89ca643a11e">first_cpu</a>;
<a name="l00164"></a>00164   <span class="keywordflow">if</span>(last_env != cur_env) {
<a name="l00165"></a>00165     last_env = cur_env;
<a name="l00166"></a>00166   <a class="code" href="group__main.html#gde1e39517fb49cbd640974e60b2d97b4" title="array of CPU general-purpose registers, such as R_EAX, R_EBX">TEMU_cpu_regs</a> = cur_env-&gt;regs;
<a name="l00167"></a>00167     <a class="code" href="group__main.html#g618a614f57fe705bad85a2f402251599" title="pointer to instruction pointer EIP">TEMU_cpu_eip</a> = &amp;cur_env-&gt;eip;
<a name="l00168"></a>00168 <span class="preprocessor">#if TAINT_FLAGS</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>    <a class="code" href="group__main.html#g4da30d59a88b0847b8c8a6e027e56f48" title="pointer to EFLAGS">TEMU_cpu_eflags</a> = &amp;<a class="code" href="TEMU__main_8c.html#a84f32d4b4b1c96ef3a37d7ea0b054b6">TEMU_eflags</a>;
<a name="l00170"></a>00170 <span class="preprocessor">#else</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>    <a class="code" href="group__main.html#g4da30d59a88b0847b8c8a6e027e56f48" title="pointer to EFLAGS">TEMU_cpu_eflags</a> = &amp;cur_env-&gt;eflags;
<a name="l00172"></a>00172 <span class="preprocessor">#endif    </span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>  <a class="code" href="group__main.html#g5bf0e7c60af3d1994fc5757696929787" title="pointer to hidden flags">TEMU_cpu_hflags</a> = &amp;cur_env-&gt;hflags;
<a name="l00174"></a>00174   TEMU_cpu_segs = cur_env-&gt;segs;
<a name="l00175"></a>00175   TEMU_cpu_ldt = &amp;cur_env-&gt;ldt;
<a name="l00176"></a>00176   TEMU_cpu_gdt = &amp;cur_env-&gt;gdt;
<a name="l00177"></a>00177   TEMU_cpu_idt = &amp;cur_env-&gt;idt;
<a name="l00178"></a>00178   <a class="code" href="group__main.html#gcb89fd3b872d66b0d5be6b25e36a68a5" title="array of CPU control registers, such as CR0 and CR1">TEMU_cpu_cr</a> = cur_env-&gt;cr;
<a name="l00179"></a>00179   <a class="code" href="group__main.html#g57a9331466c08424b1d745046e82b36d" title="pointer to DF register">TEMU_cpu_df</a> = &amp;cur_env-&gt;df;
<a name="l00180"></a>00180   <a class="code" href="group__main.html#g7c988f9c1d0f64edcb170e87f2408ece">TEMU_cc_op</a> = &amp;cur_env-&gt;cc_op;
<a name="l00181"></a>00181     TEMU_cpu_xmm_regs = (<a class="code" href="unionXMMReg.html">XMMReg</a> *)&amp;cur_env-&gt;xmm_regs;
<a name="l00182"></a>00182     <span class="comment">//TEMU_cpu_mmx_regs = (MMXReg *)&amp;cur_env-&gt;fpregs;</span>
<a name="l00183"></a>00183     TEMU_cpu_fp_regs = cur_env-&gt;fpregs;
<a name="l00184"></a>00184   <a class="code" href="group__main.html#g43d7eef44703fc8c40c446de5b35fd12" title="FPU - top of Floating Point register stack.">TEMU_cpu_fp_stt</a> = &amp;cur_env-&gt;fpstt;
<a name="l00185"></a>00185   <a class="code" href="group__main.html#g1c3ca604b187e41b7508bd542ef28eff" title="FPU - Status Register.">TEMU_cpu_fpus</a> = &amp;cur_env-&gt;fpus;
<a name="l00186"></a>00186   <a class="code" href="group__main.html#g01c866766eb145d30b60cb2b8663ee3a" title="FPU - Control Register.">TEMU_cpu_fpuc</a> = &amp;cur_env-&gt;fpuc;
<a name="l00187"></a>00187   <a class="code" href="group__main.html#g3ee3c546ab6c0db47056cdd8eb55f321" title="FPU - Tag Register.">TEMU_cpu_fptags</a> = cur_env-&gt;fptags;
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="comment">/*</span>
<a name="l00193"></a>00193 <span class="comment"> * NIC related functions</span>
<a name="l00194"></a>00194 <span class="comment"> */</span>
<a name="l00195"></a>00195 
<a name="l00196"></a><a class="code" href="TEMU__main_8h.html#8d36af23d88cf52b91f855af259367c0">00196</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#8d36af23d88cf52b91f855af259367c0">TEMU_nic_receive</a>(<span class="keyword">const</span> uint8_t * buf, <span class="keywordtype">int</span> <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>, <span class="keywordtype">int</span> cur_pos,
<a name="l00197"></a>00197                       <span class="keywordtype">int</span> start, <span class="keywordtype">int</span> stop)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (temu_plugin &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#9f19c6d8662ab7784a598f729f951338" title="This callback is invoked when a network packet is received by NIC.">nic_recv</a>)
<a name="l00200"></a>00200     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#9f19c6d8662ab7784a598f729f951338" title="This callback is invoked when a network packet is received by NIC.">nic_recv</a>((uint8_t *) buf, size, cur_pos, start, stop);
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="TEMU__main_8h.html#2ed59d511ab8292eac3af4d02142d8ed">00204</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#2ed59d511ab8292eac3af4d02142d8ed">TEMU_nic_send</a>(uint32_t addr, <span class="keywordtype">int</span> <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>, uint8_t * buf)
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206   <span class="keywordflow">if</span> (temu_plugin &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#461e4e6270fd31ef6c4fa6e076f69dab" title="This callback is invoked when a network packet is sent out by NIC.">nic_send</a>)
<a name="l00207"></a>00207     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#461e4e6270fd31ef6c4fa6e076f69dab" title="This callback is invoked when a network packet is sent out by NIC.">nic_send</a>(addr, size, buf);
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00211"></a><a class="code" href="TEMU__main_8h.html#d79fa69ed9efdf1ff86b2af39ea23ef5">00211</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#d79fa69ed9efdf1ff86b2af39ea23ef5">TEMU_nic_out</a>(uint32_t addr, <span class="keywordtype">int</span> <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>)
<a name="l00212"></a>00212 {
<a name="l00213"></a>00213   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>)
<a name="l00214"></a>00214     <span class="keywordflow">return</span>;
<a name="l00215"></a>00215 <span class="preprocessor">#if TAINT_ENABLED</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#d74f45680a8cdbbbcda8e8091b47ffa4">taintcheck_nic_out</a>(addr, size);
<a name="l00217"></a>00217 <span class="preprocessor">#endif</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>}
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 
<a name="l00221"></a><a class="code" href="TEMU__main_8h.html#ebbfa8850fbae18e64344035799af12a">00221</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#ebbfa8850fbae18e64344035799af12a">TEMU_nic_in</a>(uint32_t addr, <span class="keywordtype">int</span> <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>)
<a name="l00224"></a>00224     <span class="keywordflow">return</span>;
<a name="l00225"></a>00225 <span class="preprocessor">#if TAINT_ENABLED</span>
<a name="l00226"></a>00226 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#0ca6e469e6089275de877c25bbcce5fa">taintcheck_nic_in</a>(addr, size);
<a name="l00227"></a>00227 <span class="preprocessor">#endif</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>}
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="comment">/* </span>
<a name="l00231"></a>00231 <span class="comment"> * keyboard related functions </span>
<a name="l00232"></a>00232 <span class="comment"> */</span>
<a name="l00233"></a><a class="code" href="TEMU__main_8h.html#01084755e86d354b12cad68bbfe49baf">00233</a> <span class="keywordtype">void</span> *<a class="code" href="TEMU__main_8c.html#01084755e86d354b12cad68bbfe49baf">TEMU_KbdState</a> = NULL;
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="TEMU__main_8h.html#15b469a51fca72496a2d58a4389fcdbf">00235</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#15b469a51fca72496a2d58a4389fcdbf">TEMU_read_keystroke</a>(<span class="keywordtype">void</span> *s)
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237   <span class="keywordflow">if</span> (s != <a class="code" href="TEMU__main_8c.html#01084755e86d354b12cad68bbfe49baf">TEMU_KbdState</a>)
<a name="l00238"></a>00238     <span class="keywordflow">return</span>;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="keywordflow">if</span> (temu_plugin &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#4cca549b7f2c09fa47d356115741dd78">send_keystroke</a>)
<a name="l00241"></a>00241     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#4cca549b7f2c09fa47d356115741dd78">send_keystroke</a>(cpu_single_env-&gt;tempidx);
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 <span class="comment">/*</span>
<a name="l00246"></a>00246 <span class="comment"> * A virtual device that reads messages from the kernel module in the guest windows</span>
<a name="l00247"></a>00247 <span class="comment"> */</span>
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">00249</a> <span class="keyword">static</span> FILE *<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a> = NULL;
<a name="l00250"></a>00250 
<a name="l00251"></a><a class="code" href="TEMU__main_8c.html#a8395d488ab2aeeb60a2271997a2c95d">00251</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#a8395d488ab2aeeb60a2271997a2c95d">TEMU_virtdev_write_data</a>(<span class="keywordtype">void</span> *opaque, uint32_t addr,
<a name="l00252"></a>00252                                     uint32_t val)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254   <span class="keyword">static</span> <span class="keywordtype">char</span> syslogline[512];
<a name="l00255"></a>00255   <span class="keyword">static</span> <span class="keywordtype">int</span> pos = 0;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="keywordflow">if</span> (pos &gt;= 510)
<a name="l00258"></a>00258     pos = 510;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="keywordflow">if</span> ((syslogline[pos++] = (<span class="keywordtype">char</span>) val) == 0) {
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (temu_plugin &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#993329f07169671277d326718e7b993d" title="This callback handles OS-level semantics information.">guest_message</a>)
<a name="l00262"></a>00262       temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#993329f07169671277d326718e7b993d" title="This callback handles OS-level semantics information.">guest_message</a>(syslogline);
<a name="l00263"></a>00263     fprintf(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a>, <span class="stringliteral">"%s"</span>, syslogline);
<a name="l00264"></a>00264     fflush(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a>);
<a name="l00265"></a>00265     pos = 0;
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00270"></a><a class="code" href="TEMU__main_8h.html#b6ac3e63c4debd76d3844286f159abc3">00270</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#b6ac3e63c4debd76d3844286f159abc3">TEMU_virtdev_init</a>()
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272   <span class="keywordtype">int</span> res =
<a name="l00273"></a>00273       register_ioport_write(0x68, 1, 1, <a class="code" href="TEMU__main_8c.html#a8395d488ab2aeeb60a2271997a2c95d">TEMU_virtdev_write_data</a>, NULL);
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (res) {
<a name="l00275"></a>00275     fprintf(stderr, <span class="stringliteral">"failure on initializing TEMU virtual device\n"</span>);
<a name="l00276"></a>00276     exit(-1);
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278   <span class="keywordflow">if</span> (!(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a> = fopen(<span class="stringliteral">"guest.log"</span>, <span class="stringliteral">"w"</span>))) {
<a name="l00279"></a>00279     fprintf(stderr, <span class="stringliteral">"failure on opening guest.log \n"</span>);
<a name="l00280"></a>00280     exit(-1);
<a name="l00281"></a>00281   }
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a><a class="code" href="TEMU__main_8c.html#56edd1af6ded789c132180e18f2a5556">00285</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#56edd1af6ded789c132180e18f2a5556">TEMU_after_loadvm</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *param)
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (temu_plugin &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#5d9d02e1a4f88a1bda09094f0a7729d5">after_loadvm</a>)
<a name="l00288"></a>00288     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#5d9d02e1a4f88a1bda09094f0a7729d5">after_loadvm</a>(param);
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a><a class="code" href="TEMU__main_8c.html#e2fa24a4b16ecd7ccd3151c832e7d2ef">00291</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#e2fa24a4b16ecd7ccd3151c832e7d2ef">TEMU_register_rw</a>(<span class="keywordtype">int</span> reg_id, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> is_write)
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293   assert(cpu_single_env != NULL);
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   uint32_t offset, <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>;
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">switch</span>(reg_id) {
<a name="l00298"></a>00298     <span class="keywordflow">case</span> eax_reg: offset = R_EAX*4, size=4;
<a name="l00299"></a>00299       <span class="keywordflow">break</span>;
<a name="l00300"></a>00300     <span class="keywordflow">case</span> ecx_reg: offset = R_ECX*4, size=4;
<a name="l00301"></a>00301       <span class="keywordflow">break</span>;
<a name="l00302"></a>00302     <span class="keywordflow">case</span> edx_reg: offset = R_EDX*4, size=4;
<a name="l00303"></a>00303       <span class="keywordflow">break</span>;
<a name="l00304"></a>00304     <span class="keywordflow">case</span> ebx_reg: offset = R_EBX*4, size=4;
<a name="l00305"></a>00305       <span class="keywordflow">break</span>;
<a name="l00306"></a>00306     <span class="keywordflow">case</span> esp_reg: offset = R_ESP*4, size=4;
<a name="l00307"></a>00307       <span class="keywordflow">break</span>;
<a name="l00308"></a>00308     <span class="keywordflow">case</span> ebp_reg: offset = R_EBP*4, size=4;
<a name="l00309"></a>00309       <span class="keywordflow">break</span>;
<a name="l00310"></a>00310     <span class="keywordflow">case</span> esi_reg: offset = R_ESI*4, size=4;
<a name="l00311"></a>00311       <span class="keywordflow">break</span>;
<a name="l00312"></a>00312     <span class="keywordflow">case</span> edi_reg: offset = R_EDI*4, size=4;
<a name="l00313"></a>00313       <span class="keywordflow">break</span>;
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordflow">case</span> al_reg: offset = R_EAX*4, size=1;
<a name="l00316"></a>00316          <span class="keywordflow">break</span>;
<a name="l00317"></a>00317     <span class="keywordflow">case</span> cl_reg: offset = R_ECX*4, size=1;
<a name="l00318"></a>00318          <span class="keywordflow">break</span>;
<a name="l00319"></a>00319     <span class="keywordflow">case</span> dl_reg: offset = R_EDX*4, size=1;
<a name="l00320"></a>00320          <span class="keywordflow">break</span>;
<a name="l00321"></a>00321     <span class="keywordflow">case</span> bl_reg: offset = R_EBX*4, size=1;
<a name="l00322"></a>00322          <span class="keywordflow">break</span>;
<a name="l00323"></a>00323     <span class="keywordflow">case</span> ah_reg: offset = R_EAX*4+1, size=1;
<a name="l00324"></a>00324          <span class="keywordflow">break</span>;
<a name="l00325"></a>00325     <span class="keywordflow">case</span> ch_reg: offset = R_ECX*4+1, size=1;
<a name="l00326"></a>00326          <span class="keywordflow">break</span>;
<a name="l00327"></a>00327     <span class="keywordflow">case</span> dh_reg: offset = R_EDX*4+1, size=1;
<a name="l00328"></a>00328          <span class="keywordflow">break</span>;
<a name="l00329"></a>00329     <span class="keywordflow">case</span> bh_reg: offset = R_EBX*4+1, size=1;
<a name="l00330"></a>00330          <span class="keywordflow">break</span>;
<a name="l00331"></a>00331        
<a name="l00332"></a>00332     <span class="keywordflow">case</span> ax_reg: offset = R_EAX*4, size=2; 
<a name="l00333"></a>00333          <span class="keywordflow">break</span>;
<a name="l00334"></a>00334     <span class="keywordflow">case</span> cx_reg: offset = R_ECX*4, size=2; 
<a name="l00335"></a>00335          <span class="keywordflow">break</span>;
<a name="l00336"></a>00336     <span class="keywordflow">case</span> dx_reg: offset = R_EDX*4, size=2; 
<a name="l00337"></a>00337          <span class="keywordflow">break</span>;
<a name="l00338"></a>00338     <span class="keywordflow">case</span> bx_reg: offset = R_EBX*4, size=2; 
<a name="l00339"></a>00339          <span class="keywordflow">break</span>;
<a name="l00340"></a>00340     <span class="keywordflow">case</span> sp_reg: offset = R_ESP*4, size=2; 
<a name="l00341"></a>00341          <span class="keywordflow">break</span>;
<a name="l00342"></a>00342     <span class="keywordflow">case</span> bp_reg: offset = R_EBP*4, size=2; 
<a name="l00343"></a>00343          <span class="keywordflow">break</span>;
<a name="l00344"></a>00344     <span class="keywordflow">case</span> si_reg: offset = R_ESI*4, size=2; 
<a name="l00345"></a>00345          <span class="keywordflow">break</span>;
<a name="l00346"></a>00346     <span class="keywordflow">case</span> di_reg: offset = R_EDI*4, size=2; 
<a name="l00347"></a>00347          <span class="keywordflow">break</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="keywordflow">case</span> eip_reg: 
<a name="l00350"></a>00350             <span class="keywordflow">if</span> (is_write) 
<a name="l00351"></a>00351               cpu_single_env-&gt;eip = *(uint32_t *)buf;
<a name="l00352"></a>00352             <span class="keywordflow">else</span>
<a name="l00353"></a>00353           *(uint32_t *)buf = cpu_single_env-&gt;eip;
<a name="l00354"></a>00354         <span class="keywordflow">return</span>;
<a name="l00355"></a>00355     <span class="keywordflow">case</span> cr3_reg: 
<a name="l00356"></a>00356         if (is_write) assert(0);
<a name="l00357"></a>00357         <span class="keywordflow">else</span>
<a name="l00358"></a>00358           *(uint32_t *)buf = cpu_single_env-&gt;cr[3];
<a name="l00359"></a>00359         <span class="keywordflow">return</span>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">default</span>: 
<a name="l00362"></a>00362       assert(0);
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364   
<a name="l00365"></a>00365   <span class="comment">//XXX:Here, we assume little endian in the host machine!!! </span>
<a name="l00366"></a>00366   <span class="keywordflow">if</span>(is_write)
<a name="l00367"></a>00367     memcpy((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)cpu_single_env-&gt;regs + offset, buf, size);
<a name="l00368"></a>00368   <span class="keywordflow">else</span>
<a name="l00369"></a>00369     memcpy(buf, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)cpu_single_env-&gt;regs + offset, size); 
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="group__main.html#g291b6ce15a5ac9a1dbf1591c80de4790">00372</a> <span class="keywordtype">void</span> <a class="code" href="group__main.html#g291b6ce15a5ac9a1dbf1591c80de4790" title="Read from a register.">TEMU_read_register</a>(<span class="keywordtype">int</span> reg_id, <span class="keywordtype">void</span> *buf)
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <a class="code" href="TEMU__main_8c.html#e2fa24a4b16ecd7ccd3151c832e7d2ef">TEMU_register_rw</a>(reg_id, buf, 0);
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 
<a name="l00377"></a><a class="code" href="group__main.html#g454d4d21067d9e180f76400fb72a2078">00377</a> <span class="keywordtype">void</span> <a class="code" href="group__main.html#g454d4d21067d9e180f76400fb72a2078" title="Write into a register.">TEMU_write_register</a>(<span class="keywordtype">int</span> reg_id, <span class="keywordtype">void</span> *buf)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379   <a class="code" href="TEMU__main_8c.html#e2fa24a4b16ecd7ccd3151c832e7d2ef">TEMU_register_rw</a>(reg_id, buf, 1);
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a><a class="code" href="group__main.html#g83dc2500423a7496ae08e0a9e67ab55c">00382</a> target_ulong <a class="code" href="group__main.html#g83dc2500423a7496ae08e0a9e67ab55c" title="Convert virtual address into physical address.">TEMU_get_phys_addr</a>(target_ulong addr)
<a name="l00383"></a>00383 {
<a name="l00384"></a>00384     <span class="keywordtype">int</span> mmu_idx, index;
<a name="l00385"></a>00385   uint32_t phys_addr;
<a name="l00386"></a>00386   CPUState *env = cpu_single_env? cpu_single_env: <a class="code" href="TEMU__main_8c.html#3a715a3fed794e260b78c89ca643a11e">first_cpu</a>;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388     index = (addr &gt;&gt; TARGET_PAGE_BITS) &amp; (CPU_TLB_SIZE - 1);
<a name="l00389"></a>00389     mmu_idx = cpu_mmu_index(env);
<a name="l00390"></a>00390     <span class="keywordflow">if</span> (__builtin_expect(env-&gt;tlb_table[mmu_idx][index].addr_read !=
<a name="l00391"></a>00391                          (addr &amp; TARGET_PAGE_MASK), 0)) {
<a name="l00392"></a>00392     phys_addr = cpu_get_phys_page_debug(env, addr&amp;TARGET_PAGE_MASK);
<a name="l00393"></a>00393         <span class="keywordflow">if</span>(phys_addr == -1) <span class="keywordflow">return</span> -1;
<a name="l00394"></a>00394     phys_addr += addr&amp;(TARGET_PAGE_SIZE - 1);
<a name="l00395"></a>00395     <span class="keywordflow">return</span> phys_addr;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 <span class="preprocessor">#if 0 //not sure if we need it --Heng Yin   </span>
<a name="l00398"></a>00398 <span class="preprocessor"></span>    pd = env-&gt;tlb_table[mmu_idx][index].addr_read &amp; ~TARGET_PAGE_MASK;
<a name="l00399"></a>00399     <span class="keywordflow">if</span> (pd &gt; IO_MEM_ROM &amp;&amp; !(pd &amp; IO_MEM_ROMD)) {
<a name="l00400"></a>00400         cpu_abort(env, <span class="stringliteral">"Trying to execute code outside RAM or ROM at 0x"</span> TARGET_FMT_lx <span class="stringliteral">"\n"</span>, addr);
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 <span class="preprocessor">#endif</span>
<a name="l00403"></a>00403 <span class="preprocessor"></span>    <span class="keywordflow">return</span> addr + env-&gt;tlb_table[mmu_idx][index].addend - (<span class="keywordtype">unsigned</span> long)phys_ram_base;
<a name="l00404"></a>00404 }
<a name="l00405"></a>00405 
<a name="l00406"></a><a class="code" href="TEMU__main_8c.html#b29c0643b741af4ec5aafd995f714c08">00406</a> uint32_t <a class="code" href="TEMU__main_8c.html#b29c0643b741af4ec5aafd995f714c08">TEMU_get_physaddr_with_cr3</a>(target_ulong cr3, target_ulong addr)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     CPUState *env = cpu_single_env? cpu_single_env: <a class="code" href="TEMU__main_8c.html#3a715a3fed794e260b78c89ca643a11e">first_cpu</a>;
<a name="l00409"></a>00409     target_ulong saved_cr3 = env-&gt;cr[3];
<a name="l00410"></a>00410   uint32_t phys_addr;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   env-&gt;cr[3] = cr3;
<a name="l00413"></a>00413   phys_addr = cpu_get_phys_page_debug(env, addr&amp;TARGET_PAGE_MASK);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     env-&gt;cr[3] = saved_cr3;
<a name="l00416"></a>00416     <span class="keywordflow">return</span> phys_addr;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 
<a name="l00420"></a>00420 
<a name="l00421"></a><a class="code" href="group__main.html#gaaf1edf71b8b8d59ee8e044988634b29">00421</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#gaaf1edf71b8b8d59ee8e044988634b29">TEMU_memory_rw</a>(uint32_t addr, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> is_write)
<a name="l00422"></a>00422 {
<a name="l00423"></a>00423   <span class="keywordtype">int</span> l;
<a name="l00424"></a>00424   target_ulong page, phys_addr;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keywordflow">while</span> (len &gt; 0) {
<a name="l00427"></a>00427     page = addr &amp; TARGET_PAGE_MASK;
<a name="l00428"></a>00428     phys_addr = <a class="code" href="group__main.html#g83dc2500423a7496ae08e0a9e67ab55c" title="Convert virtual address into physical address.">TEMU_get_phys_addr</a>(page);
<a name="l00429"></a>00429     <span class="keywordflow">if</span>(phys_addr == -1)
<a name="l00430"></a>00430       <span class="keywordflow">return</span> -1;
<a name="l00431"></a>00431     l = (page + TARGET_PAGE_SIZE) -addr;
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (l &gt; len) 
<a name="l00433"></a>00433       l = len;
<a name="l00434"></a>00434     <a class="code" href="group__main.html#gc52f2ac78cf48b9e4c2204c739d5a790" title="read or write a physical memory region">cpu_physical_memory_rw</a>(phys_addr + (addr &amp; ~ TARGET_PAGE_MASK),
<a name="l00435"></a>00435         buf, l, is_write);
<a name="l00436"></a>00436     len -= l;
<a name="l00437"></a>00437     buf += l;
<a name="l00438"></a>00438     addr += l;
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440   <span class="keywordflow">return</span> 0;    
<a name="l00441"></a>00441 }
<a name="l00442"></a>00442 
<a name="l00443"></a><a class="code" href="TEMU__main_8c.html#cc218c25d4cd1aad09ed1aee2951e255">00443</a> <span class="keywordtype">int</span> <a class="code" href="TEMU__main_8c.html#cc218c25d4cd1aad09ed1aee2951e255">TEMU_memory_rw_with_cr3</a>(target_ulong cr3, uint32_t addr, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> is_write)
<a name="l00444"></a>00444 {
<a name="l00445"></a>00445   <span class="keywordtype">int</span> l;
<a name="l00446"></a>00446   target_ulong page, phys_addr;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="keywordflow">while</span> (len &gt; 0) {
<a name="l00449"></a>00449     page = addr &amp; TARGET_PAGE_MASK;
<a name="l00450"></a>00450     phys_addr = <a class="code" href="TEMU__main_8c.html#b29c0643b741af4ec5aafd995f714c08">TEMU_get_physaddr_with_cr3</a>(cr3, page);
<a name="l00451"></a>00451     <span class="keywordflow">if</span>(phys_addr == -1)
<a name="l00452"></a>00452       <span class="keywordflow">return</span> -1;
<a name="l00453"></a>00453     l = (page + TARGET_PAGE_SIZE) -addr;
<a name="l00454"></a>00454     <span class="keywordflow">if</span> (l &gt; len) 
<a name="l00455"></a>00455       l = len;
<a name="l00456"></a>00456     <a class="code" href="group__main.html#gc52f2ac78cf48b9e4c2204c739d5a790" title="read or write a physical memory region">cpu_physical_memory_rw</a>(phys_addr + (addr &amp; ~ TARGET_PAGE_MASK),
<a name="l00457"></a>00457         buf, l, is_write);
<a name="l00458"></a>00458     len -= l;
<a name="l00459"></a>00459     buf += l;
<a name="l00460"></a>00460     addr += l;
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462   <span class="keywordflow">return</span> 0;    
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 
<a name="l00466"></a><a class="code" href="group__main.html#gb9b50db6a07dd2a391ce72501ebdb0e1">00466</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#gb9b50db6a07dd2a391ce72501ebdb0e1" title="Read from a memory region by its virtual address.">TEMU_read_mem</a>(uint32_t vaddr, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *buf)
<a name="l00467"></a>00467 {
<a name="l00468"></a>00468   <span class="keywordflow">return</span> <a class="code" href="group__main.html#gaaf1edf71b8b8d59ee8e044988634b29">TEMU_memory_rw</a>(vaddr, buf, len, 0);
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="group__main.html#g05084184110f0c5eb62c6223c795738b">00471</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#g05084184110f0c5eb62c6223c795738b" title="Write into a memory region by its virtual address.">TEMU_write_mem</a>(uint32_t vaddr, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *buf)
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473   <span class="keywordflow">return</span> <a class="code" href="group__main.html#gaaf1edf71b8b8d59ee8e044988634b29">TEMU_memory_rw</a>(vaddr, buf, len, 1);
<a name="l00474"></a>00474 }
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="group__main.html#g995890ecde5b2c40f8b55b4a7b21f0a8">00476</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#g995890ecde5b2c40f8b55b4a7b21f0a8">TEMU_read_mem_with_cr3</a>(target_ulong cr3, uint32_t vaddr, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *buf)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478   <span class="keywordflow">return</span> <a class="code" href="TEMU__main_8c.html#cc218c25d4cd1aad09ed1aee2951e255">TEMU_memory_rw_with_cr3</a>(cr3, vaddr, buf, len, 0);
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="group__main.html#g47de33f8cc3f989d67eeb95d50be76b1">00481</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#g47de33f8cc3f989d67eeb95d50be76b1">TEMU_write_mem_with_cr3</a>(target_ulong cr3, uint32_t vaddr, <span class="keywordtype">int</span> len, <span class="keywordtype">void</span> *buf)
<a name="l00482"></a>00482 {
<a name="l00483"></a>00483   <span class="keywordflow">return</span> <a class="code" href="TEMU__main_8c.html#cc218c25d4cd1aad09ed1aee2951e255">TEMU_memory_rw_with_cr3</a>(cr3, vaddr, buf, len, 1);
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a><a class="code" href="TEMU__main_8h.html#739616e70a78fcde6ab81b55b01824a2">00488</a> <span class="keywordtype">int</span> <a class="code" href="TEMU__main_8c.html#739616e70a78fcde6ab81b55b01824a2">TEMU_bdrv_pread</a>(<span class="keywordtype">void</span> *bs, int64_t offset, <span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> count)
<a name="l00489"></a>00489 {
<a name="l00490"></a>00490   <span class="keywordflow">return</span> bdrv_pread((BlockDriverState *)bs, offset, buf, count);
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="preprocessor">#ifdef DEFINE_BLOCK_BEGIN</span>
<a name="l00494"></a><a class="code" href="TEMU__main_8h.html#b09a3ce112258e8d2e3e603420a5f4f0">00494</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="TEMU__main_8c.html#b09a3ce112258e8d2e3e603420a5f4f0">TEMU_block_begin</a>()
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>)
<a name="l00497"></a>00497     <span class="keywordflow">return</span> 0;
<a name="l00498"></a>00498   <span class="comment">//block_begin needs to be called globally</span>
<a name="l00499"></a>00499   <span class="keywordtype">int</span> res = temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#249e490e627bcace802fcb13097df006" title="This callback is invoked at the beginning of each basic block.">block_begin</a>();
<a name="l00500"></a>00500   <span class="keywordflow">return</span> res;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 <span class="preprocessor">#endif</span>
<a name="l00503"></a>00503 <span class="preprocessor"></span>
<a name="l00504"></a>00504 <span class="preprocessor">#ifdef DEFINE_BLOCK_END</span>
<a name="l00505"></a><a class="code" href="TEMU__main_8c.html#6e0f63269b5084745f9cbd2200fcd138">00505</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#6e0f63269b5084745f9cbd2200fcd138">TEMU_block_end</a>()
<a name="l00506"></a>00506 {
<a name="l00507"></a>00507   <span class="keywordflow">if</span> (<a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a> &amp;&amp; temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#6bb3637da58843e312aacf955967b8dc" title="This callback is invoked at the end of each basic block.">block_end</a>)
<a name="l00508"></a>00508     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#6bb3637da58843e312aacf955967b8dc" title="This callback is invoked at the end of each basic block.">block_end</a>();
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 <span class="preprocessor">#endif</span>
<a name="l00511"></a>00511 <span class="preprocessor"></span>
<a name="l00512"></a>00512 <span class="preprocessor">#ifdef DEFINE_INSN_BEGIN</span>
<a name="l00513"></a><a class="code" href="TEMU__main_8h.html#1be035b206e14a68739e426f014fcb42">00513</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#1be035b206e14a68739e426f014fcb42">TEMU_insn_begin</a>(uint32_t pc_start)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> || !<a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a>)
<a name="l00516"></a>00516     <span class="keywordflow">return</span>;
<a name="l00517"></a>00517 <span class="preprocessor">#if TAINT_ENABLED &amp;&amp; !defined(DEFINE_INSN_END)</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#8ba4dce789e7fe78985beb63f5f0f01a" title="flag that indicates if the current instruction propagates taint">insn_tainted</a> = 0;
<a name="l00519"></a>00519 <span class="preprocessor">#endif  </span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>
<a name="l00521"></a>00521   <span class="keywordflow">if</span> (temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#f9fa85a2a68c5ea08803c8a244614453" title="This callback is invoked at the beginning of each instruction.">insn_begin</a>)
<a name="l00522"></a>00522     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#f9fa85a2a68c5ea08803c8a244614453" title="This callback is invoked at the beginning of each instruction.">insn_begin</a>();
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 <span class="preprocessor">#endif</span>
<a name="l00525"></a>00525 <span class="preprocessor"></span>
<a name="l00526"></a>00526 <span class="preprocessor">#ifdef DEFINE_INSN_END</span>
<a name="l00527"></a><a class="code" href="TEMU__main_8h.html#075c9dce4d6f4d2f3d46c9679779454b">00527</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#075c9dce4d6f4d2f3d46c9679779454b">TEMU_insn_end</a>()
<a name="l00528"></a>00528 {
<a name="l00529"></a>00529   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> || !<a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a>)
<a name="l00530"></a>00530     <span class="keywordflow">return</span>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#6adec47f9f0541e921058692b1fa5798" title="This callback is invoked at the end of each instruction.">insn_end</a>)
<a name="l00533"></a>00533     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#6adec47f9f0541e921058692b1fa5798" title="This callback is invoked at the end of each instruction.">insn_end</a>();
<a name="l00534"></a>00534 <span class="preprocessor">#if TAINT_ENABLED    </span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#8ba4dce789e7fe78985beb63f5f0f01a" title="flag that indicates if the current instruction propagates taint">insn_tainted</a> = 0;
<a name="l00536"></a>00536 <span class="preprocessor">#endif</span>
<a name="l00537"></a>00537 <span class="preprocessor"></span>}
<a name="l00538"></a>00538 <span class="preprocessor">#endif</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span>
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="TEMU__main_8h.html#6c737cc37cbfae5c470588ee2522db90">00541</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#6c737cc37cbfae5c470588ee2522db90">TEMU_update_cr3</a>()
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   <span class="keywordflow">if</span> (!temu_plugin) 
<a name="l00544"></a>00544     <a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a> = 0;
<a name="l00545"></a>00545   <span class="keywordflow">else</span>
<a name="l00546"></a>00546     <a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a> = (temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#60b5ab751ae4d15984244a780929a2d9" title="CR3 of a specified process to be monitored. 0 means system-wide monitoring, including...">monitored_cr3</a> == 0 ||
<a name="l00547"></a>00547                     temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#60b5ab751ae4d15984244a780929a2d9" title="CR3 of a specified process to be monitored. 0 means system-wide monitoring, including...">monitored_cr3</a> == cpu_single_env-&gt;cr[3]);
<a name="l00548"></a>00548 }
<a name="l00549"></a>00549 
<a name="l00550"></a><a class="code" href="TEMU__main_8h.html#2b5e21d72f0b7a8c23a0bbac64e6b033">00550</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#2b5e21d72f0b7a8c23a0bbac64e6b033">TEMU_do_interrupt</a>(<span class="keywordtype">int</span> intno, <span class="keywordtype">int</span> is_int, target_ulong next_eip)
<a name="l00551"></a>00551 {
<a name="l00552"></a>00552 <span class="preprocessor">#ifdef HANDLE_INTERRUPT</span>
<a name="l00553"></a>00553 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(temu_plugin) temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#6b5c7f7531b26b63e71786b17f10ef18" title="This callback indicates an interrupt is happening.">do_interrupt</a>(intno, is_int, next_eip);
<a name="l00554"></a>00554 <span class="preprocessor">#endif</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span>}
<a name="l00556"></a>00556 
<a name="l00557"></a><a class="code" href="TEMU__main_8h.html#5b8a2e24520405f064cf393684bc39f6">00557</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#098c9144050c3f79d4571a24553167b5">TEMU_after_iret_protected</a>()
<a name="l00558"></a>00558 {
<a name="l00559"></a>00559 <span class="preprocessor">#ifdef HANDLE_INTERRUPT</span>
<a name="l00560"></a>00560 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(temu_plugin) temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#c9a05334a071d1a4247039c4e024e60f" title="This callback indicates an interrupt is returned.">after_iret_protected</a>();
<a name="l00561"></a>00561 <span class="preprocessor">#endif</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span>}
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="group__main.html#g04c805667e009215991f4b3a6e20b840">00565</a> <span class="keywordtype">int</span> <a class="code" href="group__main.html#g04c805667e009215991f4b3a6e20b840" title="Given a virtual address, this function returns the page access status.">TEMU_get_page_access</a>(uint32_t addr)
<a name="l00566"></a>00566 {
<a name="l00567"></a>00567   uint32_t pde_addr, pte_addr;
<a name="l00568"></a>00568   uint32_t pde, pte;
<a name="l00569"></a>00569   CPUState *env = cpu_single_env? cpu_single_env: <a class="code" href="TEMU__main_8c.html#3a715a3fed794e260b78c89ca643a11e">first_cpu</a>;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571   <span class="keywordflow">if</span> (env-&gt;cr[4] &amp; CR4_PAE_MASK) {
<a name="l00572"></a>00572   uint32_t pdpe_addr, pde_addr, pte_addr;
<a name="l00573"></a>00573   uint32_t pdpe;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575   pdpe_addr = ((env-&gt;cr[3] &amp; ~0x1f) + ((addr &gt;&gt; 30) &lt;&lt; 3)) &amp; 
<a name="l00576"></a>00576     env-&gt;a20_mask;
<a name="l00577"></a>00577   pdpe = ldl_phys(pdpe_addr);
<a name="l00578"></a>00578   <span class="keywordflow">if</span> (!(pdpe &amp; PG_PRESENT_MASK))
<a name="l00579"></a>00579     <span class="keywordflow">return</span> -1;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   pde_addr = ((pdpe &amp; ~0xfff) + (((addr &gt;&gt; 21) &amp; 0x1ff) &lt;&lt; 3)) &amp;
<a name="l00582"></a>00582     env-&gt;a20_mask;
<a name="l00583"></a>00583   pde = ldl_phys(pde_addr);
<a name="l00584"></a>00584   <span class="keywordflow">if</span> (!(pde &amp; PG_PRESENT_MASK)) {
<a name="l00585"></a>00585     <span class="keywordflow">return</span> -1;
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587   <span class="keywordflow">if</span> (pde &amp; PG_PSE_MASK) {
<a name="l00588"></a>00588     <span class="comment">/* 2 MB page */</span>
<a name="l00589"></a>00589     <span class="keywordflow">return</span> (pde &amp; PG_RW_MASK);
<a name="l00590"></a>00590   } 
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="comment">/* 4 KB page */</span>
<a name="l00593"></a>00593   pte_addr = ((pde &amp; ~0xfff) + (((addr &gt;&gt; 12) &amp; 0x1ff) &lt;&lt; 3)) &amp;
<a name="l00594"></a>00594     env-&gt;a20_mask;
<a name="l00595"></a>00595   pte = ldl_phys(pte_addr);
<a name="l00596"></a>00596   <span class="keywordflow">if</span>(!(pte &amp; PG_PRESENT_MASK))
<a name="l00597"></a>00597     <span class="keywordflow">return</span> -1;
<a name="l00598"></a>00598   <span class="keywordflow">return</span> (pte &amp; PG_RW_MASK);
<a name="l00599"></a>00599   } 
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="keywordflow">if</span> (!(env-&gt;cr[0] &amp; CR0_PG_MASK)) {
<a name="l00602"></a>00602   <span class="comment">/* page addressing is disabled */</span>
<a name="l00603"></a>00603   <span class="keywordflow">return</span> 1;
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606   <span class="comment">/* page directory entry */</span>
<a name="l00607"></a>00607   pde_addr = ((env-&gt;cr[3] &amp; ~0xfff) + ((addr &gt;&gt; 20) &amp; ~3)) &amp; env-&gt;a20_mask;
<a name="l00608"></a>00608   pde = ldl_phys(pde_addr);
<a name="l00609"></a>00609   <span class="keywordflow">if</span> (!(pde &amp; PG_PRESENT_MASK)) 
<a name="l00610"></a>00610   <span class="keywordflow">return</span> -1;
<a name="l00611"></a>00611   <span class="keywordflow">if</span> ((pde &amp; PG_PSE_MASK) &amp;&amp; (env-&gt;cr[4] &amp; CR4_PSE_MASK)) {
<a name="l00612"></a>00612   <span class="comment">/* page size is 4MB */</span>
<a name="l00613"></a>00613   <span class="keywordflow">return</span> (pde &amp; PG_RW_MASK);
<a name="l00614"></a>00614   }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">/* page directory entry */</span>
<a name="l00617"></a>00617   pte_addr = ((pde &amp; ~0xfff) + ((addr &gt;&gt; 10) &amp; 0xffc)) &amp; env-&gt;a20_mask;
<a name="l00618"></a>00618   pte = ldl_phys(pte_addr);
<a name="l00619"></a>00619   <span class="keywordflow">if</span> (!(pte &amp; PG_PRESENT_MASK))
<a name="l00620"></a>00620   <span class="keywordflow">return</span> -1;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="comment">/* page size is 4K */</span>
<a name="l00623"></a>00623   <span class="keywordflow">return</span> (pte &amp; PG_RW_MASK);
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 
<a name="l00627"></a><a class="code" href="group__main.html#g7f768596cd733f7fd9f03aff741eea54">00627</a> <span class="keywordtype">void</span> <a class="code" href="group__main.html#g7f768596cd733f7fd9f03aff741eea54" title="Pause the guest system.">TEMU_stop_vm</a>()
<a name="l00628"></a>00628 {
<a name="l00629"></a>00629 <span class="comment">/*  CPUState *env = cpu_single_env? cpu_single_env: mon_get_cpu();</span>
<a name="l00630"></a>00630 <span class="comment">  env-&gt;exception_index = EXCP_HLT;</span>
<a name="l00631"></a>00631 <span class="comment">  longjmp(env-&gt;jmp_env, 1); */</span>
<a name="l00632"></a>00632   <a class="code" href="group__main.html#g3ba811f15006cad963111f9d186faf62" title="Pause VM.">vm_stop</a>(EXCP_INTERRUPT);
<a name="l00633"></a>00633 }
<a name="l00634"></a>00634 
<a name="l00635"></a><a class="code" href="TEMU__main_8h.html#da5de6e4ce02d1a556a47523474501d9">00635</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#da5de6e4ce02d1a556a47523474501d9">TEMU_loadvm</a>(<span class="keywordtype">void</span> *opaque)
<a name="l00636"></a>00636 {
<a name="l00637"></a>00637   <span class="keywordtype">char</span> **loadvm_args = opaque;
<a name="l00638"></a>00638   <span class="keywordflow">if</span>(loadvm_args[0]) {
<a name="l00639"></a>00639     <a class="code" href="group__main.html#g6f0faa4e4bf7b162f0ad6e09a49a3b5f" title="Load a previously saved VM snapshot.">do_loadvm</a>(loadvm_args[0]);
<a name="l00640"></a>00640     free(loadvm_args[0]);
<a name="l00641"></a>00641     loadvm_args[0] = NULL;
<a name="l00642"></a>00642   }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644   <span class="keywordflow">if</span>(loadvm_args[1]) {
<a name="l00645"></a>00645     <a class="code" href="TEMU__main_8c.html#4cb507949622fc763a2a146936e1421e">do_load_plugin</a>(loadvm_args[1]);
<a name="l00646"></a>00646     free(loadvm_args[1]);
<a name="l00647"></a>00647     loadvm_args[1] = NULL;
<a name="l00648"></a>00648   }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   <span class="keywordflow">if</span>(loadvm_args[2]) {
<a name="l00651"></a>00651     <a class="code" href="TEMU__main_8c.html#56edd1af6ded789c132180e18f2a5556">TEMU_after_loadvm</a>(loadvm_args[2]);
<a name="l00652"></a>00652     free(loadvm_args[2]);
<a name="l00653"></a>00653     loadvm_args[2] = NULL;
<a name="l00654"></a>00654   }
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="preprocessor">#ifdef CALLSTRING_ANALYSIS</span>
<a name="l00658"></a><a class="code" href="TEMU__main_8c.html#553a9df48048a91ab20f2d95903d3b50">00658</a> <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#553a9df48048a91ab20f2d95903d3b50">TEMU_call_analysis</a>(uint32_t next_eip)
<a name="l00659"></a>00659 {
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (!<a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a> || !<a class="code" href="TEMU__main_8c.html#6cce2e5fe1f6c5ef2fe46e72e9d279c7" title="this flag indicates whether the plugin should receive callback">should_monitor</a>)
<a name="l00661"></a>00661     <span class="keywordflow">return</span>;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   temu_plugin-&gt;<a class="code" href="structplugin__interface__t.html#84197690d4d5bd9f1f9e44581cebf3a5">call_analysis</a>(next_eip);
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="preprocessor">#endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>
<a name="l00668"></a>00668 
<a name="l00669"></a><a class="code" href="TEMU__main_8c.html#021ab3168d43ae30321d4b1e2c86f2ee">00669</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#021ab3168d43ae30321d4b1e2c86f2ee">TEMU_save</a>(<a class="code" href="TEMU__lib_8h.html#652d9ff75e9a5ca7a6667335be7755f7">QEMUFile</a> *f, <span class="keywordtype">void</span> *opaque)
<a name="l00670"></a>00670 {
<a name="l00671"></a>00671   uint32_t len = strlen(<a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>) + 1;
<a name="l00672"></a>00672   <a class="code" href="TEMU__lib_8h.html#890dcce225bd20035e37663959c78dd3">qemu_put_be32</a>(f, len);
<a name="l00673"></a>00673   <a class="code" href="TEMU__lib_8h.html#bab97910b84b56c8e39acace6be4578a">qemu_put_buffer</a>(f, <a class="code" href="TEMU__main_8c.html#0466361fb9ade70165b5f254801bd2c0">temu_plugin_path</a>, len);
<a name="l00674"></a>00674   
<a name="l00675"></a>00675   <span class="comment">//save guest.log </span>
<a name="l00676"></a>00676   <span class="comment">//we only save guest.log when no plugin is loaded</span>
<a name="l00677"></a>00677   <span class="keywordflow">if</span>(len == 1) { 
<a name="l00678"></a>00678     FILE *fp = fopen(<span class="stringliteral">"guest.log"</span>, <span class="stringliteral">"r"</span>);
<a name="l00679"></a>00679     uint32_t <a class="code" href="taintcheck_8h.html#c5171f8c3bbd36e5425e886a5e20e790">size</a>;
<a name="l00680"></a>00680     <span class="keywordflow">if</span>(!fp) {
<a name="l00681"></a>00681       fprintf(stderr, <span class="stringliteral">"cannot open guest.log!\n"</span>);
<a name="l00682"></a>00682       <span class="keywordflow">return</span>;
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685     fseek(fp, 0, SEEK_END);
<a name="l00686"></a>00686     size = ftell(fp);
<a name="l00687"></a>00687     <a class="code" href="TEMU__lib_8h.html#890dcce225bd20035e37663959c78dd3">qemu_put_be32</a>(f, size);
<a name="l00688"></a>00688     rewind(fp);
<a name="l00689"></a>00689     <span class="keywordflow">if</span>(size &gt; 0) {
<a name="l00690"></a>00690       TEMU_CompressState_t state;
<a name="l00691"></a>00691       <span class="keywordflow">if</span>(TEMU_compress_open(&amp;state, f) &lt; 0)
<a name="l00692"></a>00692         <span class="keywordflow">return</span>;
<a name="l00693"></a>00693       
<a name="l00694"></a>00694       <span class="keywordflow">while</span>(!feof(fp)) {
<a name="l00695"></a>00695         uint8_t buf[4096];
<a name="l00696"></a>00696         <span class="keywordtype">size_t</span> res = fread(buf, 1, <span class="keyword">sizeof</span>(buf), fp);
<a name="l00697"></a>00697         TEMU_compress_buf(&amp;state, buf, res);
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699     
<a name="l00700"></a>00700       TEMU_compress_close(&amp;state);
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702     fclose(fp);
<a name="l00703"></a>00703   }
<a name="l00704"></a>00704   
<a name="l00705"></a>00705   <a class="code" href="TEMU__lib_8h.html#890dcce225bd20035e37663959c78dd3">qemu_put_be32</a>(f, <a class="code" href="group__main.html#gf24f155e5a9b6ee9bc9a6e6ef9c3987d" title="This flag tells if emulation mode is enabled.">TEMU_emulation_started</a>); 
<a name="l00706"></a>00706   <a class="code" href="TEMU__lib_8h.html#890dcce225bd20035e37663959c78dd3">qemu_put_be32</a>(f, 0x12345678); <span class="comment">//terminator</span>
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a><a class="code" href="TEMU__main_8c.html#20a2feaa005365e8572fe926c6153915">00709</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="TEMU__main_8c.html#20a2feaa005365e8572fe926c6153915">TEMU_load</a>(<a class="code" href="TEMU__lib_8h.html#652d9ff75e9a5ca7a6667335be7755f7">QEMUFile</a> *f, <span class="keywordtype">void</span> *opaque, <span class="keywordtype">int</span> version_id)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711   uint32_t len = <a class="code" href="TEMU__lib_8h.html#ebe35a2af379d13c34a34a441b86a8f2">qemu_get_be32</a>(f);
<a name="l00712"></a>00712   <span class="keywordtype">char</span> tmp_plugin_path[PATH_MAX];
<a name="l00713"></a>00713   
<a name="l00714"></a>00714   <span class="keywordflow">if</span>(<a class="code" href="TEMU__main_8c.html#6dcdf632512586080e32f7c5884dc3d1">plugin_handle</a>) 
<a name="l00715"></a>00715     <a class="code" href="TEMU__main_8c.html#296c171a88bcf16ca992030fa9e8dbd8">do_unload_plugin</a>();
<a name="l00716"></a>00716   <a class="code" href="TEMU__lib_8h.html#75e165529dd609aa13a21ce80bc80859">qemu_get_buffer</a>(f, tmp_plugin_path, len);
<a name="l00717"></a>00717   <span class="keywordflow">if</span>(tmp_plugin_path[len - 1] != 0)
<a name="l00718"></a>00718     <span class="keywordflow">return</span> -EINVAL;
<a name="l00719"></a>00719   
<a name="l00720"></a>00720   <span class="comment">//load guest.log</span>
<a name="l00721"></a>00721   <span class="keywordflow">if</span>(len == 1) {
<a name="l00722"></a>00722     fclose(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a>);
<a name="l00723"></a>00723     <span class="keywordflow">if</span> (!(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a> = fopen(<span class="stringliteral">"guest.log"</span>, <span class="stringliteral">"w"</span>))) {
<a name="l00724"></a>00724       fprintf(stderr, <span class="stringliteral">"cannot open guest.log for write!\n"</span>);
<a name="l00725"></a>00725       <span class="keywordflow">return</span> -EINVAL;
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727     
<a name="l00728"></a>00728     uint32_t file_size = <a class="code" href="TEMU__lib_8h.html#ebe35a2af379d13c34a34a441b86a8f2">qemu_get_be32</a>(f);
<a name="l00729"></a>00729     uint8_t buf[4096];
<a name="l00730"></a>00730     uint32_t i;
<a name="l00731"></a>00731     TEMU_CompressState_t state;
<a name="l00732"></a>00732     <span class="keywordflow">if</span>(TEMU_decompress_open(&amp;state, f) &lt; 0) 
<a name="l00733"></a>00733       <span class="keywordflow">return</span> -EINVAL;
<a name="l00734"></a>00734     
<a name="l00735"></a>00735     <span class="keywordflow">for</span>(i=0; i&lt;file_size; ) {
<a name="l00736"></a>00736       uint32_t len = (<span class="keyword">sizeof</span>(buf) &lt; file_size-i)? <span class="keyword">sizeof</span>(buf): file_size - i;
<a name="l00737"></a>00737       <span class="keywordflow">if</span>(TEMU_decompress_buf(&amp;state, buf, len) &lt; 0)
<a name="l00738"></a>00738         <span class="keywordflow">return</span> -EINVAL;
<a name="l00739"></a>00739         
<a name="l00740"></a>00740       fwrite(buf, 1, len, <a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a>);
<a name="l00741"></a>00741       i += len;
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743     TEMU_decompress_close(&amp;state);
<a name="l00744"></a>00744     fflush(<a class="code" href="TEMU__main_8c.html#ebc6bd569fcc4b121494f7dc13c0d1e2">guestlog</a>);
<a name="l00745"></a>00745   }  
<a name="l00746"></a>00746      
<a name="l00747"></a>00747   <span class="keywordflow">if</span>(len &gt; 1) 
<a name="l00748"></a>00748     <a class="code" href="TEMU__main_8c.html#4cb507949622fc763a2a146936e1421e">do_load_plugin</a>(tmp_plugin_path);
<a name="l00749"></a>00749     
<a name="l00750"></a>00750   uint32_t emul_started = <a class="code" href="TEMU__lib_8h.html#ebe35a2af379d13c34a34a441b86a8f2">qemu_get_be32</a>(f);
<a name="l00751"></a>00751   <span class="keywordflow">if</span>(emul_started) 
<a name="l00752"></a>00752     <a class="code" href="TEMU__main_8c.html#08c9f0059115b4caac93e2012d013e82">do_enable_emulation</a>();
<a name="l00753"></a>00753   <span class="keywordflow">else</span>
<a name="l00754"></a>00754     <a class="code" href="TEMU__main_8c.html#6a885d8e289babe0cb19bb3b669461d5">do_disable_emulation</a>();
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   uint32_t terminator = <a class="code" href="TEMU__lib_8h.html#ebe35a2af379d13c34a34a441b86a8f2">qemu_get_be32</a>(f);
<a name="l00757"></a>00757   <span class="keywordflow">if</span>(terminator != 0x12345678)
<a name="l00758"></a>00758     <span class="keywordflow">return</span> -EINVAL;
<a name="l00759"></a>00759     
<a name="l00760"></a>00760   <span class="keywordflow">return</span> 0;
<a name="l00761"></a>00761 }
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="TEMU__main_8h.html#9d17b8c5c75eda1e16eee68b7a0ca494">00763</a> <span class="keywordtype">void</span> <a class="code" href="TEMU__main_8c.html#9d17b8c5c75eda1e16eee68b7a0ca494">TEMU_init</a>()
<a name="l00764"></a>00764 {
<a name="l00765"></a>00765   <a class="code" href="group__main.html#g655c4a0d124e52ec2188c6af01fd8362" title="Register a VM entity for saving and restoring VM states.">register_savevm</a>(<span class="stringliteral">"TEMU"</span>, 0, 1, <a class="code" href="TEMU__main_8c.html#021ab3168d43ae30321d4b1e2c86f2ee">TEMU_save</a>, <a class="code" href="TEMU__main_8c.html#20a2feaa005365e8572fe926c6153915">TEMU_load</a>, NULL);
<a name="l00766"></a>00766   TEMU_vm_compress_init();
<a name="l00767"></a>00767 <span class="preprocessor">#if TAINT_ENABLED</span>
<a name="l00768"></a>00768 <span class="preprocessor"></span>  <a class="code" href="taintcheck_8c.html#0198f483b97eebf43575cabc19a98341">taintcheck_init</a>();
<a name="l00769"></a>00769 <span class="preprocessor">#endif</span>
<a name="l00770"></a>00770 <span class="preprocessor"></span>}
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 
</pre></div></div>
<hr>
<p class="footer">
Generated on Fri Mar 30 16:18:24 2012 for <a href="http://bitblaze.cs.berkeley.edu/temu.html">TEMU</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.5.8</a><br/>
Copyright &copy; 2008-2009, BitBlaze Project. All Rights Reserved.</p>

<hr>
<!--#include virtual="/attrib.incl" -->

</body>
</html>
