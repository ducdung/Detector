<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="keywords" content="TEMU, dynamic analysis, binary analysis, dynamic
taint analysis"/>
<meta name="description" content="C/C++/OCaml Source Code Documentation for the TEMU Project."/>
<title>TEMU: hookapi: Function Hooking Facility</title>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head><body>
<p class="title">TEMU: Dynamic Binary Analysis Platform</p>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>hookapi: Function Hooking Facility</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hookapi.html#g3a41889bd8abee4969a2692be485a6a6">hookapi_check_call</a> (int in_context)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uintptr_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hookapi.html#g3de79f04102eb683630687f5c68f67d8">hookapi_hook_function</a> (int is_global, uint32_t eip, <a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a> fnhook, void *opaque, uint32_t sizeof_opaque)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hookapi.html#g3ce5d12449ea0167665200a87ca0565c">hookapi_hook_function_byname</a> (const char *mod, const char *func, int is_global, <a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a> fnhook, void *opaque, uint32_t sizeof_opaque)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">uintptr_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hookapi.html#g24246f19568f3b959a59105b62b81c4e">hookapi_hook_return</a> (uint32_t eip, <a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a> fnhook, void *opaque, uint32_t sizeof_opaque)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hookapi.html#gbc076bbb385daba3697ccda50ae50c74">hookapi_remove_hook</a> (uintptr_t handle)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g3a41889bd8abee4969a2692be485a6a6"></a><!-- doxytag: member="hookapi.h::hookapi_check_call" ref="g3a41889bd8abee4969a2692be485a6a6" args="(int in_context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hookapi_check_call           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>in_context</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
search and invoke the corresponding hooks at the current eip <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>in_context</em>&nbsp;</td><td>flag that specifies if the current execution is in the analysis context This function is usually called in plugin's block_begin callback, to check and invoke hooks. This function deals with the situation that multiple hooks are installed on the same function entry or exit. It is able to distinguish different hooks and invoke them correctly. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="hookapi_8c-source.html#l00333">333</a> of file <a class="el" href="hookapi_8c-source.html">hookapi.c</a>.</p>

<p>References <a class="el" href="hookapi_8c-source.html#l00034">hookapi_record::eip</a>, <a class="el" href="TEMU__main_8c-source.html#l00038">TEMU_cpu_cr</a>, <a class="el" href="TEMU__main_8c-source.html#l00031">TEMU_cpu_eip</a>, and <a class="el" href="TEMU__main_8c-source.html#l00030">TEMU_cpu_regs</a>.</p>

</div>
</div><p>
<a class="anchor" name="g3de79f04102eb683630687f5c68f67d8"></a><!-- doxytag: member="hookapi.h::hookapi_hook_function" ref="g3de79f04102eb683630687f5c68f67d8" args="(int is_global, uint32_t eip, hook_proc_t fnhook, void *opaque, uint32_t sizeof_opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t hookapi_hook_function           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>eip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a>&nbsp;</td>
          <td class="paramname"> <em>fnhook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>sizeof_opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
install a hook at the function entry <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>is_global</em>&nbsp;</td><td>flag specifies if this hook should be invoked globally or only in certain execution context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>eip</em>&nbsp;</td><td>address of function to be hooked (has to be the start of a basic block </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fnhook</em>&nbsp;</td><td>address of function hook </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>opaque</em>&nbsp;</td><td>address of an opaque structure provided by caller (has to be globally allocated)</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a handle that uniquely specifies this hook </dd></dl>

<p>Definition at line <a class="el" href="hookapi_8c-source.html#l00243">243</a> of file <a class="el" href="hookapi_8c-source.html">hookapi.c</a>.</p>

<p>References <a class="el" href="hookapi_8c-source.html#l00034">hookapi_record::eip</a>, <a class="el" href="hookapi_8c-source.html#l00038">hookapi_record::fnhook</a>, <a class="el" href="hookapi_8c-source.html#l00035">hookapi_record::is_global</a>, <a class="el" href="hookapi_8c-source.html#l00039">hookapi_record::opaque</a>, and <a class="el" href="hookapi_8c-source.html#l00040">hookapi_record::sizeof_opaque</a>.</p>

<p>Referenced by <a class="el" href="procmod_8cpp-source.html#l00623">detecting_kernel()</a>, <a class="el" href="read__linux_8c-source.html#l00344">for_all_hookpoints()</a>, <a class="el" href="hookapi_8c-source.html#l00357">hookapi_hook_function_byname()</a>, and <a class="el" href="function__map_8cpp-source.html#l00155">resolve_fun_to_hook()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g3ce5d12449ea0167665200a87ca0565c"></a><!-- doxytag: member="hookapi.h::hookapi_hook_function_byname" ref="g3ce5d12449ea0167665200a87ca0565c" args="(const char *mod, const char *func, int is_global, hook_proc_t fnhook, void *opaque, uint32_t sizeof_opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hookapi_hook_function_byname           </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>mod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>is_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a>&nbsp;</td>
          <td class="paramname"> <em>fnhook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>sizeof_opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
install a hook at the function entry by specifying module name and function name <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>mod</em>&nbsp;</td><td>module name that this function is located in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>func</em>&nbsp;</td><td>function name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flag</em>&nbsp;</td><td>specifies if this hook should be invoked globally or only in certain execution context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>eip</em>&nbsp;</td><td>address of function to be hooked (has to be the start of a basic block </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fnhook</em>&nbsp;</td><td>address of function hook </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>opaque</em>&nbsp;</td><td>address of an opaque structure provided by caller (has to be globally allocated) </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="hookapi_8c-source.html#l00357">357</a> of file <a class="el" href="hookapi_8c-source.html">hookapi.c</a>.</p>

<p>References <a class="el" href="function__map_8cpp-source.html#l00141">add_fun_to_hook()</a>, <a class="el" href="hookapi_8c-source.html#l00034">hookapi_record::eip</a>, <a class="el" href="hookapi_8c-source.html#l00243">hookapi_hook_function()</a>, and <a class="el" href="function__map_8cpp-source.html#l00217">query_eip()</a>.</p>

<p>Referenced by <a class="el" href="reduce__taint_8c-source.html#l00125">reduce_taint_init()</a>.</p>

</div>
</div><p>
<a class="anchor" name="g24246f19568f3b959a59105b62b81c4e"></a><!-- doxytag: member="hookapi.h::hookapi_hook_return" ref="g24246f19568f3b959a59105b62b81c4e" args="(uint32_t eip, hook_proc_t fnhook, void *opaque, uint32_t sizeof_opaque)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t hookapi_hook_return           </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>eip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="hookapi_8h.html#2e3871d1647a63d42c2b0ace7dcc3c94">hook_proc_t</a>&nbsp;</td>
          <td class="paramname"> <em>fnhook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>opaque</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>sizeof_opaque</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
install a hook at the function exit <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>eip</em>&nbsp;</td><td>function return address </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fnhook</em>&nbsp;</td><td>address of function hook </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>opaque</em>&nbsp;</td><td>address of an opaque structure provided by caller (has to be globally allocated) </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>a handle that uniquely specifies this hook The implementation of this function handles multi-threading. It means, when multple threads call the same function and register the same return address, we can distinguish different hooks, and invoke them correctly. </dd></dl>

<p>Definition at line <a class="el" href="hookapi_8c-source.html#l00267">267</a> of file <a class="el" href="hookapi_8c-source.html">hookapi.c</a>.</p>

<p>References <a class="el" href="hookapi_8c-source.html#l00037">hookapi_record::cr3</a>, <a class="el" href="hookapi_8c-source.html#l00034">hookapi_record::eip</a>, <a class="el" href="hookapi_8c-source.html#l00036">hookapi_record::esp</a>, <a class="el" href="hookapi_8c-source.html#l00038">hookapi_record::fnhook</a>, <a class="el" href="hookapi_8c-source.html#l00035">hookapi_record::is_global</a>, <a class="el" href="hookapi_8c-source.html#l00039">hookapi_record::opaque</a>, <a class="el" href="hookapi_8c-source.html#l00040">hookapi_record::sizeof_opaque</a>, <a class="el" href="TEMU__main_8c-source.html#l00038">TEMU_cpu_cr</a>, and <a class="el" href="TEMU__main_8c-source.html#l00030">TEMU_cpu_regs</a>.</p>

<p>Referenced by <a class="el" href="reduce__taint_8c-source.html#l00077">alloca_probe_call()</a>.</p>

</div>
</div><p>
<a class="anchor" name="gbc076bbb385daba3697ccda50ae50c74"></a><!-- doxytag: member="hookapi.h::hookapi_remove_hook" ref="gbc076bbb385daba3697ccda50ae50c74" args="(uintptr_t handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void hookapi_remove_hook           </td>
          <td>(</td>
          <td class="paramtype">uintptr_t&nbsp;</td>
          <td class="paramname"> <em>handle</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
remove a hook <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>hook handle returned by hookapi_hook_function or hookapi_hook_return This function will not free the opaque structure provided by the caller when installing a hook. The caller is responsible for freeing it. The exception is when the user's plugin is unloaded, the opaque structure is freed automatically to avoid memory leakage. Likewise, when a vm state (i.e. snapshot) is loaded, the opaque structure is allocated and restored automatically. </td></tr>
  </table>
</dl>

<p>Definition at line <a class="el" href="hookapi_8c-source.html#l00291">291</a> of file <a class="el" href="hookapi_8c-source.html">hookapi.c</a>.</p>

<p>References <a class="el" href="hookapi_8c-source.html#l00045">hookapi_handle::handle</a>.</p>

<p>Referenced by <a class="el" href="reduce__taint_8c-source.html#l00068">alloca_probe_ret()</a>, and <a class="el" href="read__linux_8c-source.html#l00344">for_all_hookpoints()</a>.</p>

</div>
</div><p>
</div>
<hr>
<p class="footer">
Generated on Fri Mar 30 16:18:26 2012 for <a href="http://bitblaze.cs.berkeley.edu/temu.html">TEMU</a> by
<a href="http://www.doxygen.org"><img src="doxygen.png" alt="Doxygen"
align="middle" border="0"/>1.5.8</a><br/>
Copyright &copy; 2008-2009, BitBlaze Project. All Rights Reserved.</p>

<hr>
<!--#include virtual="/attrib.incl" -->

</body>
</html>
